# Gemini Setup Guide

This guide explains how to use Google's Gemini instead of OpenAI in your D&D project.

## Prerequisites

1. **Google AI API Key**
   - Get your free API key from: https://makersuite.google.com/app/apikey
   - Or use your work's Gemini API access

2. **API Quota**
   - Free tier: 60 requests per minute
   - Much more generous than OpenAI's free tier!

## Setup Instructions

### For Portrait Generation

1. **Install Python dependencies:**
   ```bash
   cd scripts
   pip install -r requirements.txt
   ```

2. **Set your API key:**
   ```bash
   export GOOGLE_AI_API_KEY='your-api-key-here'
   # or
   export GEMINI_API_KEY='your-api-key-here'
   ```

3. **Run the Gemini portrait generator:**
   ```bash
   python3 generate_all_portraits_gemini.py
   ```

   Or with options:
   ```bash
   python3 generate_all_portraits_gemini.py --force --create-js
   ```

### For Character Builder (Web Interface)

The character builder can use Gemini for AI-powered narrator comments and name generation.

1. **Open the Gemini-enabled character builder:**
   ```
   open character-builder/index-gemini.html
   ```

2. **Add your API key:**
   - Click "Settings" in the interface
   - Enter your Google AI API key
   - It will be saved in your browser's local storage

3. **Start building characters!**
   - The AI narrator will provide deadpan commentary
   - Name suggestions will be generated by Gemini
   - All features work the same as the OpenAI version

## API Differences

### Gemini vs OpenAI

| Feature | OpenAI | Gemini |
|---------|--------|--------|
| **Text Generation** | GPT-3.5/4 | Gemini 1.5 Pro |
| **Image Generation** | DALL-E 3 | Imagen (via Vertex AI) |
| **Free Tier** | Limited | 60 req/min |
| **API Format** | Chat completions | generateContent |
| **Context Window** | 4K-128K tokens | Up to 1M tokens |

### API Format Examples

**OpenAI:**
```javascript
fetch('https://api.openai.com/v1/chat/completions', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    model: 'gpt-3.5-turbo',
    messages: [
      { role: 'system', content: 'You are a narrator' },
      { role: 'user', content: 'Tell me a story' }
    ]
  })
})
```

**Gemini:**
```javascript
fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-pro:generateContent?key=${apiKey}`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    contents: [{
      parts: [{
        text: 'System: You are a narrator\n\nUser: Tell me a story'
      }]
    }]
  })
})
```

## Image Generation Notes

**Important:** Google's Imagen API is currently available through:

1. **Vertex AI** (Requires GCP project setup)
   - More complex setup
   - Requires authentication with service account
   - Production-ready

2. **Google AI Studio** (Web Interface)
   - Easy to use
   - Generate images manually
   - Good for testing/small batches

The `generate_all_portraits_gemini.py` script currently:
- Uses Gemini to enhance prompts
- Creates placeholders for images (you can replace with actual images)
- Converts images to ASCII art

For production image generation, you'll need to:
- Set up Vertex AI
- Configure GCP credentials
- Update the script to use Vertex AI Imagen

## Cost Comparison

### OpenAI Pricing
- GPT-3.5 Turbo: $0.0015/1K tokens (input), $0.002/1K tokens (output)
- DALL-E 3: $0.04 per image (1024x1024)

### Google Gemini Pricing
- Gemini 1.5 Pro: FREE up to 2 million tokens/day
- Gemini 1.5 Flash: FREE up to 15 req/min
- Imagen: Pricing varies by Vertex AI tier

## Troubleshooting

### "API key required"
Make sure you've set the environment variable:
```bash
export GOOGLE_AI_API_KEY='your-key'
```

### "Rate limit exceeded"
Free tier: 60 requests/minute. Add delays between requests or upgrade to paid tier.

### "Image generation not working"
Imagen requires Vertex AI setup. For now, you can:
1. Generate images manually via Google AI Studio
2. Use the placeholder system
3. Set up Vertex AI for automated generation

## Migration from OpenAI

If you're currently using OpenAI and want to switch:

1. **Keep your existing portraits:**
   - Your generated images in `generated_portraits/` work with both systems
   - No need to regenerate if you're happy with them

2. **Switch the character builder:**
   - Use `index-gemini.html` instead of `index.html`
   - Or update your API key storage

3. **Update environment variables:**
   ```bash
   # Old
   export OPENAI_API_KEY='sk-...'
   
   # New
   export GOOGLE_AI_API_KEY='AIza...'
   ```

## Benefits of Using Gemini

1. **Free Tier:** Much more generous than OpenAI
2. **Context Window:** 1M tokens vs 4K-128K
3. **Speed:** Often faster response times
4. **Work Access:** You already have it! ðŸŽ‰

## Next Steps

1. Get your API key: https://makersuite.google.com/app/apikey
2. Try the character builder: `open character-builder/index-gemini.html`
3. Generate portraits: `python3 scripts/generate_all_portraits_gemini.py`

## Resources

- **Google AI Studio:** https://makersuite.google.com
- **Gemini API Docs:** https://ai.google.dev/docs
- **Vertex AI Imagen:** https://cloud.google.com/vertex-ai/docs/generative-ai/image/overview
- **API Key:** https://makersuite.google.com/app/apikey

